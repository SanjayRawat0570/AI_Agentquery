<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Project L2 — API Test UI (Project Root)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
      body{font-family:Arial,Helvetica,sans-serif;max-width:980px;margin:20px auto;padding:0 12px}
      h1{margin-bottom:6px}
      .card{background:#fff;border:1px solid #e6e6e6;border-radius:8px;padding:14px;margin-bottom:12px}
      label{display:block;margin:8px 0 6px;font-weight:600}
      textarea,input,select{width:100%;padding:8px;border-radius:6px;border:1px solid #ccc}
      button{padding:8px 12px;border-radius:6px;border:1px solid #1976d2;background:#1976d2;color:#fff;cursor:pointer}
      pre.response{background:#f7f7f7;padding:10px;border-radius:6px;white-space:pre-wrap}
      .row{display:flex;gap:8px;align-items:center}
      .small{width:180px}
    </style>
  </head>
  <body>
    <h1>Project L2 — API Test UI</h1>
    <p>This HTML file lives in the project root. Open it in your browser and make sure your FastAPI server is running at <code>http://127.0.0.1:8000</code>. The UI will call the API endpoints directly using full URLs.</p>

    <div class="card">
      <h2>Orchestrator /api/query</h2>
      <label for="q_query">Customer query</label>
      <textarea id="q_query">Compare CM-Pro vs CM-Enterprise: pricing and main differences.</textarea>
      <label for="q_conv">Conversation ID (optional)</label>
      <input id="q_conv" placeholder="conv-1234" />
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="q_send">Send Query</button>
        <button id="q_addacct">Add Account Agent (admin)</button>
      </div>
      <h4>Response</h4>
      <pre id="q_result" class="response">(waiting)</pre>
    </div>

    <div class="card">
      <h2>Diagnose /api/diagnose</h2>
      <label for="d_desc">Issue description</label>
      <textarea id="d_desc">Seeing Error E1234 when calling the API — connection refused.</textarea>
      <div style="margin-top:8px"><button id="d_send">Run Diagnose</button></div>
      <h4>Response</h4>
      <pre id="d_result" class="response">(waiting)</pre>
    </div>

    <div class="card">
      <h2>Orders /api/orders/{order_id}</h2>
      <label for="o_id">Order ID</label>
      <input id="o_id" value="ORD-12345" />
      <div style="margin-top:8px"><button id="o_get">Get Order</button></div>
      <h4>Response</h4>
      <pre id="o_result" class="response">(waiting)</pre>
    </div>

    <div class="card">
      <h2>Accounts</h2>
      <label for="a_id">Account ID</label>
      <input id="a_id" value="ACC-1111" />
      <label for="a_plan">New plan (for change)</label>
      <input id="a_plan" value="cm-enterprise" />
      <div style="margin-top:8px;display:flex;gap:8px">
        <button id="a_get">Get Account</button>
        <button id="a_change">Change Subscription</button>
      </div>
      <h4>Response</h4>
      <pre id="a_result" class="response">(waiting)</pre>
    </div>

    <div class="card">
      <h2>Health & Helpers</h2>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="h_check">Health</button>
        <button id="open_static">Open static/ui.html (served by FastAPI)</button>
        <button id="open_builtin">Open built-in /ui endpoint</button>
      </div>
      <h4>Response</h4>
      <pre id="h_result" class="response">(waiting)</pre>
    </div>

    <script>
      const API_BASE = 'http://127.0.0.1:8000';
      async function fetchJson(url, opts){
        const r = await fetch(url, opts);
        const text = await r.text();
        try{ return {status: r.status, data: JSON.parse(text)} }catch(e){ return {status: r.status, data: text} }
      }

      document.getElementById('q_send').onclick = async ()=>{
        const q = document.getElementById('q_query').value;
        const conv = document.getElementById('q_conv').value;
        const body = conv ? { query: q, conversation_id: conv } : { query: q };
        document.getElementById('q_result').textContent = 'Waiting...';
        const r = await fetchJson(`${API_BASE}/api/query`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(body) });
        document.getElementById('q_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('q_addacct').onclick = async ()=>{
        document.getElementById('q_result').textContent = 'Adding account agent...';
        const r = await fetchJson(`${API_BASE}/api/admin/add_account_agent`, { method: 'POST' });
        document.getElementById('q_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('d_send').onclick = async ()=>{
        const desc = document.getElementById('d_desc').value;
        document.getElementById('d_result').textContent = 'Waiting...';
        const r = await fetchJson(`${API_BASE}/api/diagnose`, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ description: desc }) });
        document.getElementById('d_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('o_get').onclick = async ()=>{
        const id = document.getElementById('o_id').value;
        document.getElementById('o_result').textContent = 'Waiting...';
        const r = await fetchJson(`${API_BASE}/api/orders/${encodeURIComponent(id)}`);
        document.getElementById('o_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('a_get').onclick = async ()=>{
        const id = document.getElementById('a_id').value;
        document.getElementById('a_result').textContent = 'Waiting...';
        const r = await fetchJson(`${API_BASE}/api/accounts/${encodeURIComponent(id)}`);
        document.getElementById('a_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('a_change').onclick = async ()=>{
        const id = document.getElementById('a_id').value;
        const plan = document.getElementById('a_plan').value;
        document.getElementById('a_result').textContent = 'Waiting...';
        const r = await fetchJson(`${API_BASE}/api/accounts/${encodeURIComponent(id)}/change_subscription`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ plan }) });
        document.getElementById('a_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('h_check').onclick = async ()=>{
        document.getElementById('h_result').textContent = 'Waiting...';
        const r = await fetchJson(`${API_BASE}/health`);
        document.getElementById('h_result').textContent = JSON.stringify(r, null, 2);
      }

      document.getElementById('open_static').onclick = ()=>{
        window.open(`${API_BASE}/static/ui.html`, '_blank');
      }

      document.getElementById('open_builtin').onclick = ()=>{
        window.open(`${API_BASE}/ui`, '_blank');
      }
    </script>
  </body>
</html>